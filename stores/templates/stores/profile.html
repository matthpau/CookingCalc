{% extends 'AppTimesCalc/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<h1>{{ store.name }}</h1>
<h5>{{ store.OSM_storetype.icon_text|safe }} <span class="badge badge-light">{{ store.OSM_storetype.type_text|capfirst }}</span></h5>

{% if store.my_address %}
    {{ store.my_address}}<br>
{% endif %}

{% if store.website %}
    <a href="{{ store.website }}">{{ store.website }}</a><br>
{% endif %}

<a class="badge badge-secondary" href="{{ store.search_url }}">find on map</a>

<br><br>
<div id="like-section">
    {% include 'stores/like_section.html' %}
</div>

<small>
    <a href="https://www.openstreetmap.org/node/{{ store.OSM_ID }}">Edit on OpenStreetmap (requires account)</a>
</small>
<br><br>

<script>
$(function (){
    $(document).on('click', '#id_like', function(){
        console.log('hello')
        var store_id = $(this).val()
        console.log(store_id) 

        $.ajax({
            type: 'POST',
            url: "{% url 'store:store_like' %}",
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'id_like': store_id
                },
            dataType: 'json',
            success: function(newHTML){
                console.log('success')
                console.log(newHTML.form)
                $('#like-section').html(newHTML.form)
            },
            error: function(rs, e){
                console.log('fail')
                console.log(rs.responseText);
            }
        })
    })
})
</script>
{% endblock %}