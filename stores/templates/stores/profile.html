{% extends 'AppTimesCalc/base.html' %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block content %}



<h1>{% trans 'Profile for '%}{{ store.name }}</h1>
<h5>{{ store.OSM_storetype.icon_text|safe }} <span class="badge badge-light">{{ store.OSM_storetype.type_text|capfirst }}</span></h5>

{% if store.my_address %}
    {{ store.my_address}}<br>
{% endif %}

{% if store.website %}
    <a href="{{ store.website }}">{{ store.website }}</a><br>
{% endif %}

<a class="badge badge-secondary" href="{{ store.search_url }}">find on map</a>

{% if user.is_authenticated %}
    <br><br>
    <div id="like-section">
        {% include 'stores/like_section.html' %}
    </div>
{% else %}
    <p>Please <a href="{% url 'account_login' %}">login </a>to like this store</p>
{% endif %}
<br><br>

{% if user in editors %}
    <h3>{% trans "Owner Section" %}</h3>
    <p>{% blocktrans %} Welcome, {{user}}. You have the following options: {% endblocktrans %}<p>
    <p><a href="https://www.openstreetmap.org/node/{{ store.OSM_ID }}">{% trans 'Edit on OpenStreetmap (requires account) '%}</a><br>
    <small>{% trans 'Changes will appear the next day' %}</small>
    <p><a href='{% url 'store:editors' store.id %}'>{% trans "List or edit your associated accounts" %}</a><br>
    <small>{{ editors_count }} {% trans "authorised editors" %} </small>
    </p>
    <p><a href='{{ store.events_url }}'>{% trans "List or edit your events" %}</a><br>
    <small>{{ upcoming_count }} {% trans "event(s) upcoming" %} </small></p>
{% endif %}

<script>
$(function (){
    $(document).on('click', '#id_like', function(){
        var store_id = $(this).val()
        console.log(store_id) 

        $.ajax({
            type: 'POST',
            url: "{% url 'store:store_like' %}",
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'id_like': store_id
                },
            dataType: 'json',
            success: function(newHTML){
                console.log('success')
                console.log(newHTML.form)
                $('#like-section').html(newHTML.form)
            },
            error: function(rs, e){
                console.log('fail')
                console.log(rs.responseText);
            }
        })
    })
})
</script>
{% endblock %}