{% extends 'AppTimesCalc/base.html' %}
{% block content %}

{% load static %}
{% load crispy_forms_tags %}
{% load i18n %}

<!--- required urls---->
<span hidden id=editor_urls
data_current_user="{{user.email}}"
data_current_store_id="{{store_id}}"
data_get_list_url="{% url 'store:editors_list' store_id %}" 
data_add_url="#" 
data_delete_url="#" 
></span>


<p>You are {{user.email}}</p>
<h5>{% trans 'People who can add events to your store' %} {{store_id }}</h5>

<ul id='editors'>
    <!---Editors list goes here-->
</ul>
    
<p id="successMsg">
    <!----Success message goes here-->
</p>

<form method="post">
{% csrf_token %}
     <div class="form-group">
        <input type="email" id="newEmail" class="form-control" id="add_editor_email" aria-describedby="emailHelp" value="jim1@gmail.com" placeholder="{% trans 'Enter email' %}">
        <small id="emailHelp" class="form-text text-muted">{% trans 'This person must already be registered on the site' %}</small>
        <button type="button" type="button" id="addBtn" class="btn btn-primary">{% trans 'Add' %}</button>
    </div>
</form>

<script>
$(function(){

    // initial population of the list
    var endpoint =          $("#editor_urls").attr("data_get_list_url")
    var current_user =      $("#editor_urls").attr("data_current_user")
    var current_store_id =  $("#editor_urls").attr('data_current_store_id')
    
    var editors =           $('#editors')

    // input for any new emails
    

    $.ajax({
        type: 'GET',
        url: endpoint,
        success: function(data){
            var part2
            $.each(data, function(i, editor){
                var part1 = editor.email
                if (editor.email !=current_user) {
                    part2 = '<a class="badge badge-danger" href="../'+
                    current_store_id + '/' +
                    editor.id + '/editor_delete">Remove</a>'
                } else {
                    part2 = ', cannot delete, this is you'
                }
                partfinal = part1.concat(part2)
                editors.append('<li>' + partfinal +'</li>')
            })
        }
    })

    $('#addBtn').on('click', function(){
        console.log('hello')
        var new_email = $("#newEmail")
        var new_data = {
            csrfmiddlewaretoken: '{{ csrf_token }}',
            email: new_email.val(),
            store_id: current_store_id
        }
        console.log(new_data)
        $.ajax({
            type: 'POST',
            url: '/stores/editor_create',
            data: new_data,
            success: function(editor){
                console.log(editor.email)
                console.log(editor.id)

            }
        })        


    })
})










</script>

{% endblock %}